@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link href="~/Scripts/easyUI/themes/metro/easyui.css" rel="stylesheet" />
    <link href="~/Scripts/easyUI/themes/icon.css" rel="stylesheet" />
    <script src="~/Scripts/easyUI/jquery.min.js"></script>
    <script src="~/Scripts/easyUI/jquery.easyui.min.js"></script>
    
    <script src="~/Scripts/easyUI/locale/easyui-lang-zh_CN.js"></script>
    <title>Index</title>
    <script>
        $(function () {
            $("#student-major").combobox({
                width: 180,
                url: '/Majors/getMajorsByDepartmentID?deptID=1',
                valueField: 'ID',
                textField: 'Name',
                onSelect: function (record) {
                    $("#dg-student").datagrid("reload");
                }
            });
            $("#student-class").combobox({
                width: 180,
                url: '/Classes/getClasseslistByMajorId?majorID=7',
                valueField: 'ID',
                textField: 'Name',
                onSelect: function (record) {
                    $("#dg-student").datagrid("reload");
                }
            });
            $("#dg-student").datagrid({
                url: '/Students/getStudents',
                singleSelect: true,
                pagination: true,
                rownumbers: true,
                title: '学生管理——————',
                toolbar: [{
                    text: '添加',
                    iconCls: 'icon-add',
                    handler: function () {

                        $("#dlg-student").dialog({
                            title: '添加----',
                            iconCls: 'icon-add',
                            width: 400,
                            height: 300,
                            closed: false,
                            modal: true,
                            href: '/students/add',
                            buttons: [{
                                text: '保存',
                                iconCls: 'icon-save',
                                handler: function () {
                                    var f = $("#student-add-form").serialize();
                                    console.log(f);
                                    $.post("/students/addstudents", f, function (data) {
                                        if (data == "OK") {
                                            $("#dg-student").datagrid("reload");
                                            $.messager.show({
                                                title: 'TTSP',
                                                msg: '保存成功！',
                                                showType: 'show'
                                            });
                                            $("#dlg-student").dialog("close");
                                            
                                        }
                                        else
                                            $.messager.show({
                                                title: 'TTSP',
                                                msg: '保存失败！！！',
                                                showType: 'show'
                                            });
                                    }, "text")
                                }
                            }, {
                                text: '取消',
                                iconCls: 'icon-no',
                                handler: function () {
                                    $("#dlg-student-add").dialog("close");
                                }
                            }]
                        });
                    }
                },
                {
                    text: '编辑',
                    iconCls: 'icon-edit',
                    handler: function () {
                        var row = $("#dg-student").datagrid("getSelected");
                        if (row == null) {
                            $.messager.alert("提示...", "请选择行!", "warning");
                            return;
                        }
                        var id = row.ID;
                        var url = "/Students/edit/" + id;
                     
                        $("#dlg-student").dialog({
                            title:'编辑——————',
                            iconCls:'icon-edit',
                            width: 300,
                            height: 400,
                            closed: false,
                            modal: true,
                            href:url,
                            buttons: [{
                                text: '修改',
                                iconCls: 'icon-ok',
                                handler: function () {
                                    var s = $("#student-edit-form").serialize();
                                    $.get("/students/editstudents",s, function (data) {
                                        if (data == "OK") {
                                            $("#dg-student").datagrid("reload");
                                            $.messager.show({
                                                title: 'TTSP',
                                                msg: '编辑成功！',
                                                showType: 'show'
                                            });
                                            $("#dlg-student").dialog("close");
                                        }
                                        else {
                                            $.messager.show({
                                                title: 'TTSP',
                                                msg: '编辑失败！',
                                                showType: 'show'
                                            });
                                        }
                                    }, "text")
                                }
                            }, {
                                text: '取消',
                                iconCls: 'icon-no',
                                handler: function () {
                                    $("#dlg-student").dialog({ closed: true });
                                }
                            }]
                        });
                    }
                }, '-',
                {
                    text: '删除',
                    iconCls: 'icon-remove',
                    handler: function () {
                        var row = $("#dg-student").datagrid("getSelected");
                        if (row == null) {
                            $.messager.alert("提示...", "请选择行!", "warning");
                            return;
                        }
                        $.messager.confirm('tips', '你确定要删除', function (r) {
                           
                            if (r) {
                                var id = $("#dg-student").datagrid("getSelected").ID;
                                $.get("/students/delectStudents", { ID: id }, function (data) {
                                    if (data == "OK") {
                                        $("#dg-student").datagrid('reload');
                                        $.messager.show({
                                            title: 'TTSP',
                                            msg: '删除成功！',
                                            showType: 'show'
                                        });
                                    }

                                }, "text");
                            }
                            else {
                                $.messager.show({
                                    title: 'TTSP',
                                    msg: '删除失败！',
                                    showType: 'show'
                                });
                            }

                        });
                    }
                }, '-',
                {
                    text: '密码重置',
                    iconCls: 'icon-lock',
                    handler: function () {
                        var row = $("#dg-student").datagrid("getSelected");
                        if (row == null) {
                            $.messager.alert('TIPS', '请选择你要重置的密码的用户', 'warning');
                            return;
                        }
                        else {
                            var name = row.Name;
                            $.messager.confirm("Tips", "你确定要重置" + name + "的密码吗？？", function (result) {
                                if (result) {
                                    var ID = row.ID;

                                    $.get("/Students/resultpass", { ID: ID }, function (data) {
                                        if (data == "OK")
                                            $.messager.show({
                                                title: 'TTSP',
                                                msg: '重置密码成功！',
                                                showType: 'show'
                                            });
                                        else
                                            $.messager.show({
                                                title: 'TTSP',
                                                msg: '重置密码失败！',
                                                showType: 'show'
                                            });
                                    }, "text")
                                }

                            });

                        }
                    }
                }
                ],
                columns: [[
                   
                    { field: 'Name', title: '学生名称', width: 100 },
                    { field: 'ClassName', title: '班级名称', width: 100 },
                    { field: 'Name', title: '专业名称', width: 100 },
                    { field: 'Studentno', title: '学号', width: 100 },
                    { field: 'TelNo', title: '手机号', width: 100 },
                    { field: 'QQNo', title: 'QQ号', width: 100 },
                    { field: 'WeChatNo', title: '微信号', width: 100 },
                    { field: 'PTelNo1', title: '家长手机号1', width: 100 },
                    { field: 'PTelNo2', title: '家长手机号2', width: 100 },
                    {field: 'lsLogin', title: '是否登录', width: 100, formatter: function (val) {
                            if (val == "0")
                                return "<input type='checkbox' disabled='disabled' />";
                            else
                                return "<input type='checkbox' checked='checked' disabled='disabled'/>";
                        }}
                ]]
            });
        });
        function query() {
            $("#dg-classes").datagrid('load', {
                majorID: $("#classes-major").combobox("getValue")
            })
           
        }
    </script>
</head>
<body>
    <div>
        专业名称:<input id="student-major" class="easyui-combobox" />
        班级名称:<input id="student-class" class="easyui-combobox" />
        <a class="easyui-linkbutton" data-options="iconCls:'icon-search'" onclick="query()">查询</a>
        <table id="dg-student"></table>
    </div>
    <div id="dlg-student"></div>
</body>
</html>
