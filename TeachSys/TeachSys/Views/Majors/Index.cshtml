@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link href="~/Scripts/easyUI/themes/metro/easyui.css" rel="stylesheet" />
    <link href="~/Scripts/easyUI/themes/icon.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-2.2.1.js"></script>
    <script src="~/Scripts/easyUI/jquery.easyui.min.js"></script>
    <script src="~/Scripts/easyUI/locale/easyui-lang-zh_CN.js"></script>
    <title>Index</title>
    <script>
        $(function () {
            $("#dlg_add").dialog({ closed: true });
            $("#dlg_delete").dialog({ closed: true });
            $("#dlg_edit").dialog({ closed: true });
            //$.get("/departments/GetDepartments", function (data) {
            //    $(data).each(function (index, chanshu) {
            //        $("#major_edit_select").append("<option value=" + chanshu.ID + ">" + chanshu.Name + "</option>");
            //    })
            //}, "json");
        })
       
        $(function () {
            $("#dg-major").datagrid({
                url: '/Majors/getMajors',
                singleSelect: true,
                rownumbers: true,
                title:'专业管理——————',
                toolbar: [{
                    text: '添加',
                    iconCls: 'icon-add',
                    handler: function () {
                        $("#dlg").dialog({
                            title: '添加----',
                            iconCls: 'icon-add',
                            width: 300,
                            height: 200,
                            closed: false,
                            modal: true,
                            href:'/Majors/add',
                            buttons: [{
                                text: '保存',
                                iconCls: 'icon-save',
                                handler: function () {
                                    $.get("/majors/addmajors", { Name: $("#major-name").val() }, function (data) {
                                        if (data == "ok") {
                                            $("#dg-major").datagrid("reload");
                                            $.messager.show({
                                                title: 'TTSP',
                                                msg: '保存成功！',
                                                showType: 'show'
                                            });
                                            $("#dlg").dialog("close");
                                            $("#major-name").val("");
                                        }
                                        else
                                            $.messager.show({
                                                title: 'TTSP',
                                                msg: '保存失败！',
                                                showType: 'show'
                                            });
                                    }, "text")
                                }
                            }, {
                                text: '取消',
                                iconCls: 'icon-no',
                                handler: function () {
                                    $("#dlg").dialog("close");
                                }
                            }]
                        });
                    }
                },
                {
                    text: '编辑',
                    iconCls: 'icon-edit',
                    handler: function () {
                        var row = $("#dg-major").datagrid("getSelected");
                        if (row == null) {
                            $.messager.alert("提示...", "请选择行!", "warning");
                            return;
                        }
                        var ID = $("#dg-major").datagrid("getSelected").ID;
                        var url="/majors/edit/"+ID;
                        $("#dlg").dialog({
                            title: '编辑——————',
                            iconCls: 'icon-edit',
                            width: 300,
                            height: 200,
                            closed: false,
                            modal: true,
                            href:url,
                            buttons: [{
                                text: '修改',
                                iconCls: 'icon-ok',
                                handler: function () {
                                    $.get("/majors/editMajors", { ID: ID, Name: $("#major_edit_input").val() }, function (data) {
                                        if (data == "OK")
                                        {
                                            $.messager.show({
                                                title: 'TTSP',
                                                msg: '编辑成功！',
                                                showType: 'show'
                                            });
                                            $("#dg-major").datagrid("reload");
                                            $("#dlg").dialog({closed:true});
                                        }
                                        else
                                            $.messager.show({
                                                title: 'TTSP',
                                                msg: '修改失败！！',
                                                showType: 'show'
                                            });
                                    }, "text")
                                }
                            }, {
                                text: '取消',
                                iconCls: 'icon-no',
                                handler: function () {
                                    $("#dlg").dialog({ closed: true });
                                }
                            }]
                        });
                    }
                }, '-',
                {
                    text: '删除',
                    iconCls: 'icon-remove',
                    handler: function () {
                        var row = $("#dg-major").datagrid("getSelected");
                        if (row == null) {
                            $.messager.alert("提示...", "请选择行!", "warning");
                            return;
                        }
                        $.messager.confirm('tips', '你确定要删除', function (r) {
                            if (r) {
                                var id = $("#dg-major").datagrid("getSelected").ID;
                                $.get("/majors/deletemajors", { ID: id }, function (data) {
                                    if (data == "OK") {
                                        $("#dg-major").datagrid("reload");
                                        $.messager.show({
                                            title: 'TTSP',
                                            msg: '删除成功！',
                                            showType: 'show'
                                        });
                                    }
                                    else {
                                        $.messager.show({
                                            title: 'TTSP',
                                            msg: '删除失败！',
                                            showType: 'show'
                                        });
                                    }
                                }, "text");
                            }


                        });
                    }
                }
                ],
                columns: [[
                    {field:'Name',title:'专业名称',width:100}
                ]]
            });
        });
    </script>
    <style>
        .weizhi {
            width: 50%;
            height: 50%;
            margin: 30px auto;
        }
    </style>
</head>
<body>
     <div>
        <table id="dg-major" style="width:300px"></table>
    </div>
    <div id="dlg"></div>

</body>
</html>
